# ä¿®æ”¹æ€»ç»“ - æœç´¢æ–¹æ³•å¯¹æ¯”åŠŸèƒ½

## ğŸ“‹ ä¿®æ”¹æ¦‚è§ˆ

æœ¬æ¬¡æ›´æ–°ä¸ºMetaFusionç³»ç»Ÿæ·»åŠ äº†ä¸‰ç§æœç´¢æ–¹æ³•çš„å¯¹æ¯”æµ‹è¯•åŠŸèƒ½ï¼Œç”¨äºè¯„ä¼°MetaFusionã€ä»…å‘é‡æœç´¢å’Œä»…å…ƒæ•°æ®æœç´¢çš„æ€§èƒ½å’Œå‡†ç¡®åº¦ã€‚

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `leader/leader.py`

#### ä¿®æ”¹çš„å‡½æ•°ï¼š`search()`
**ä½ç½®**: ç¬¬86-203è¡Œ

**ä¸»è¦æ›´æ”¹**:
- æ·»åŠ  `search_mode` å‚æ•°ï¼Œæ”¯æŒä¸‰ç§æœç´¢æ¨¡å¼ï¼š
  - `'metafusion'`: å…ƒæ•°æ®è¿‡æ»¤ + å‘é‡æœç´¢ï¼ˆé»˜è®¤ï¼‰
  - `'vector_only'`: ä»…å‘é‡æœç´¢ï¼ˆæ‰€æœ‰followerèŠ‚ç‚¹ï¼‰
  - `'metadata_only'`: ä»…å…ƒæ•°æ®æœç´¢ï¼ˆleaderèŠ‚ç‚¹ï¼‰
  
- ä¸ºæ¯ç§æ¨¡å¼å®ç°ç‹¬ç«‹çš„æœç´¢é€»è¾‘
- ä¿æŒå‘åå…¼å®¹æ€§ï¼ˆ`vector_search` å‚æ•°ä»ç„¶æœ‰æ•ˆï¼‰
- æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•å’Œç”¨æˆ·åé¦ˆ

**ä»£ç ç»Ÿè®¡**: +117è¡Œæ–°å¢ä»£ç 

#### æ–°å¢å‡½æ•°ï¼š`compare_search_methods()`
**ä½ç½®**: ç¬¬205-273è¡Œ

**åŠŸèƒ½**:
- è‡ªåŠ¨ä¾æ¬¡æ‰§è¡Œä¸‰ç§æœç´¢æ–¹æ³•
- æ”¶é›†æ€§èƒ½æŒ‡æ ‡ï¼ˆè€—æ—¶ã€ç»“æœæ•°é‡ï¼‰
- ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
- æ”¯æŒè‡ªå®šä¹‰ç­‰å¾…æ—¶é—´

**å‚æ•°**:
- `prompt`: æœç´¢æç¤ºè¯
- `output_path`: å¯é€‰çš„è¾“å‡ºè·¯å¾„
- `wait_time`: ç­‰å¾…å‘é‡æœç´¢å®Œæˆçš„æ—¶é—´ï¼ˆé»˜è®¤5ç§’ï¼‰

**è¿”å›**: åŒ…å«æ‰€æœ‰ä¸‰ç§æ–¹æ³•ç»“æœçš„å­—å…¸

**ä»£ç ç»Ÿè®¡**: +69è¡Œæ–°å¢ä»£ç 

#### æ–°å¢å‡½æ•°ï¼š`_print_comparison_summary()`
**ä½ç½®**: ç¬¬275-326è¡Œ

**åŠŸèƒ½**:
- æ ¼å¼åŒ–è¾“å‡ºå¯¹æ¯”æµ‹è¯•çš„è¯¦ç»†ç»“æœ
- åŒ…å«æ€§èƒ½å¯¹æ¯”è¡¨æ ¼
- æ˜¾ç¤ºæœç´¢ç©ºé—´å‡å°‘ç‡
- æä¾›Top-5ç»“æœé¢„è§ˆ

**ä»£ç ç»Ÿè®¡**: +52è¡Œæ–°å¢ä»£ç 

#### ä¿®æ”¹çš„å‡½æ•°ï¼š`_handle_search_result()`
**ä½ç½®**: ç¬¬357-384è¡Œ

**ä¸»è¦æ›´æ”¹**:
- å¢å¼ºç»“æœæ˜¾ç¤ºæ ¼å¼
- æ·»åŠ æœç´¢æ¨¡å¼æ ‡è¯†
- æ”¹è¿›ç»“æœæ’åºï¼ˆæŒ‰scoreé™åºï¼‰
- æ›´æ¸…æ™°çš„è¾“å‡ºæ ¼å¼ï¼ˆå¸¦åˆ†éš”çº¿å’Œæ ‡é¢˜ï¼‰

**ä»£ç ç»Ÿè®¡**: +15è¡Œä¿®æ”¹

**æ€»è®¡**: `leader/leader.py` æ–°å¢çº¦238è¡Œä»£ç 

---

### 2. `main.py`

#### ä¿®æ”¹çš„å‘½ä»¤å¤„ç†é€»è¾‘
**ä½ç½®**: ç¬¬42-74è¡Œ

**æ–°å¢å‘½ä»¤**:
1. `search_metadata <prompt>` - ä»…å…ƒæ•°æ®æœç´¢
2. `search_vector <prompt>` - ä»…å‘é‡æœç´¢ï¼ˆæ‰€æœ‰followerï¼‰
3. `search_metafusion <prompt>` - MetaFusionæœç´¢
4. `compare <prompt>` - ä¸€æ¬¡æ€§å¯¹æ¯”æ‰€æœ‰ä¸‰ç§æ–¹æ³•
5. `help` - æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤

**ä¿®æ”¹çš„å‘½ä»¤**:
- `search`: ç°åœ¨æ˜ç¡®ä½¿ç”¨MetaFusionæ¨¡å¼
- `get`: æ˜ç¡®ä½¿ç”¨MetaFusionæ¨¡å¼

**ä»£ç ç»Ÿè®¡**: +32è¡Œæ–°å¢/ä¿®æ”¹ä»£ç 

---

## ğŸ“„ æ–°å¢çš„æ–‡ä»¶

### 1. `SEARCH_COMPARISON_GUIDE.md` (176è¡Œ)
**å†…å®¹**:
- ä¸‰ç§æœç´¢æ–¹æ³•çš„è¯¦ç»†è¯´æ˜
- ä½¿ç”¨æ–¹æ³•å’Œä»£ç ç¤ºä¾‹
- è¯„ä¼°æŒ‡æ ‡è¯´æ˜
- è¾“å‡ºç¤ºä¾‹å’Œè§£è¯»
- æ³¨æ„äº‹é¡¹å’Œå®éªŒå»ºè®®

### 2. `test_search_comparison.py` (236è¡Œ)
**åŠŸèƒ½**:
- ç‹¬ç«‹çš„æµ‹è¯•è„šæœ¬
- å®Œæ•´çš„å¯¹æ¯”æµ‹è¯•æµç¨‹
- å•ç‹¬æµ‹è¯•å„æ–¹æ³•çš„é€‰é¡¹
- ç»Ÿè®¡æŠ¥å‘Šç”Ÿæˆ
- äº¤äº’å¼ç•Œé¢

**ç‰¹ç‚¹**:
- å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¸éœ€è¦å‘½ä»¤è¡Œç•Œé¢
- æ”¯æŒæ‰¹é‡æµ‹è¯•å¤šä¸ªæŸ¥è¯¢
- ç”Ÿæˆç»¼åˆç»Ÿè®¡æŠ¥å‘Š
- ç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯

### 3. `SEARCH_COMPARISON_UPDATE.md` (216è¡Œ)
**å†…å®¹**:
- æŠ€æœ¯æ›´æ–°è¯´æ˜
- ä»£ç æ”¹åŠ¨è¯¦æƒ…
- APIæ–‡æ¡£
- å‘åå…¼å®¹æ€§è¯´æ˜
- æœªæ¥æ‰©å±•æ–¹å‘

### 4. `QUICK_START_COMPARISON.md` (138è¡Œ)
**å†…å®¹**:
- 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- å‘½ä»¤é€ŸæŸ¥è¡¨
- è¾“å‡ºè§£è¯»ç¤ºä¾‹
- å¸¸è§é—®é¢˜è§£ç­”
- æµ‹è¯•æŠ€å·§

### 5. `CHANGES_SUMMARY.md` (æœ¬æ–‡ä»¶)
**å†…å®¹**:
- ä¿®æ”¹æ€»ç»“
- æ–‡ä»¶æ¸…å•
- ä»£ç ç»Ÿè®¡
- ä½¿ç”¨ç¤ºä¾‹

### 6. `README.md` (æ›´æ–°)
**ä¸»è¦æ›´æ”¹**:
- æ·»åŠ æ–°åŠŸèƒ½ä»‹ç»
- æ›´æ–°å‘½ä»¤åˆ—è¡¨
- æ·»åŠ æœç´¢æ–¹æ³•å¯¹æ¯”éƒ¨åˆ†
- æ·»åŠ æ–‡æ¡£é“¾æ¥
- æ›´æ–°ç³»ç»Ÿæ¶æ„è¯´æ˜

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### ä¿®æ”¹ç»Ÿè®¡
| æ–‡ä»¶ | æ–°å¢è¡Œæ•° | ä¿®æ”¹è¡Œæ•° | æ€»å˜æ›´ |
|------|---------|---------|--------|
| `leader/leader.py` | +238 | ~15 | 253 |
| `main.py` | +32 | ~10 | 42 |
| **æ€»è®¡** | **270** | **25** | **295** |

### æ–°å¢æ–‡ä»¶ç»Ÿè®¡
| æ–‡ä»¶ | è¡Œæ•° | ç±»å‹ |
|------|------|------|
| `SEARCH_COMPARISON_GUIDE.md` | 176 | æ–‡æ¡£ |
| `test_search_comparison.py` | 236 | ä»£ç  |
| `SEARCH_COMPARISON_UPDATE.md` | 216 | æ–‡æ¡£ |
| `QUICK_START_COMPARISON.md` | 138 | æ–‡æ¡£ |
| `CHANGES_SUMMARY.md` | ~150 | æ–‡æ¡£ |
| `README.md` (æ›´æ–°) | +100 | æ–‡æ¡£ |
| **æ€»è®¡** | **~1016** | - |

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### ä¸‰ç§æœç´¢æ¨¡å¼

#### 1. MetaFusionæœç´¢ï¼ˆé»˜è®¤ï¼‰
```python
leader.search(prompt="a beach photo in California", 
              vector_search=True, 
              search_mode='metafusion')
```
- å…ˆç”¨å…ƒæ•°æ®è¿‡æ»¤å€™é€‰silos
- ç„¶ååœ¨å€™é€‰silosä¸Šè¿›è¡Œå‘é‡æœç´¢
- å¹³è¡¡æ•ˆç‡å’Œå‡†ç¡®åº¦

#### 2. ä»…å‘é‡æœç´¢
```python
leader.search(prompt="a beautiful sunset", 
              vector_search=True, 
              search_mode='vector_only')
```
- åœ¨æ‰€æœ‰followerèŠ‚ç‚¹ä¸Šè¿›è¡Œå‘é‡æœç´¢
- ä¸ä½¿ç”¨å…ƒæ•°æ®è¿‡æ»¤
- æœ€é«˜å¬å›ç‡

#### 3. ä»…å…ƒæ•°æ®æœç´¢
```python
leader.search(prompt="photo in New York 2023", 
              search_mode='metadata_only')
```
- åªåœ¨leaderèŠ‚ç‚¹ä½¿ç”¨å…ƒæ•°æ®æŸ¥è¯¢
- ä¸è¿›è¡Œå‘é‡è®¡ç®—
- é€Ÿåº¦æœ€å¿«

### æ¯”è¾ƒæµ‹è¯•åŠŸèƒ½

```python
results = leader.compare_search_methods(
    prompt="a mountain photo in summer",
    wait_time=5
)
```

**è¿”å›ç»“æœç»“æ„**:
```python
{
    'metadata_only': {
        'results': [...],  # æœç´¢ç»“æœåˆ—è¡¨
        'time': 0.032,     # è€—æ—¶ï¼ˆç§’ï¼‰
        'count': 45        # ç»“æœæ•°é‡
    },
    'vector_only': {
        'results': [...],
        'time': 5.234,
        'count': 128
    },
    'metafusion': {
        'results': [...],
        'time': 5.156,
        'count': 87
    }
}
```

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: å‘½ä»¤è¡Œä½¿ç”¨

```bash
# å¯åŠ¨leader
python main.py leader

# åœ¨äº¤äº’ç•Œé¢ä¸­
> upload test.jpg
> mass_upload ./photos
> ls
> compare a photo of mountains in summer
```

### ç¤ºä¾‹2: æµ‹è¯•è„šæœ¬ä½¿ç”¨

```bash
python test_search_comparison.py
# é€‰æ‹©é€‰é¡¹ 1: å®Œæ•´å¯¹æ¯”æµ‹è¯•
```

### ç¤ºä¾‹3: Pythonä»£ç è°ƒç”¨

```python
from leader.leader import Leader

# åˆå§‹åŒ–
leader = Leader('localhost', 8000, 'state/', 'ViT-B/32', 'cpu', True)

# æ–¹æ³•1: å•ç‹¬æµ‹è¯•
metadata_results = leader.search("beach photo", search_mode='metadata_only')
leader.search("beach photo", vector_search=True, search_mode='vector_only')
leader.search("beach photo", vector_search=True, search_mode='metafusion')

# æ–¹æ³•2: å¯¹æ¯”æµ‹è¯•
results = leader.compare_search_methods("beach photo in summer")
print(f"Metadata: {results['metadata_only']['count']} results")
print(f"Vector: {results['vector_only']['count']} results")
print(f"MetaFusion: {results['metafusion']['count']} results")
```

---

## âœ… æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•
- [x] ä»…å…ƒæ•°æ®æœç´¢æ­£å¸¸å·¥ä½œ
- [x] ä»…å‘é‡æœç´¢æ­£å¸¸å·¥ä½œ
- [x] MetaFusionæœç´¢æ­£å¸¸å·¥ä½œ
- [x] æ¯”è¾ƒæµ‹è¯•å‡½æ•°æ­£å¸¸å·¥ä½œ
- [x] æ‰€æœ‰æ–°å‘½ä»¤æ­£å¸¸å·¥ä½œ
- [x] å‘åå…¼å®¹æ€§ä¿æŒ

### æ€§èƒ½æµ‹è¯•
- [x] æœç´¢é€Ÿåº¦ç¬¦åˆé¢„æœŸ
- [x] å¼‚æ­¥ç»“æœæ”¶é›†æ­£å¸¸
- [x] å¤šä¸ªæŸ¥è¯¢ä¸å†²çª
- [x] å¤§é‡æ•°æ®ä¸‹æ€§èƒ½ç¨³å®š

### æ–‡æ¡£æµ‹è¯•
- [x] æ‰€æœ‰æ–‡æ¡£æ¸…æ™°æ˜“æ‡‚
- [x] ä»£ç ç¤ºä¾‹å¯è¿è¡Œ
- [x] å‘½ä»¤è¯´æ˜å‡†ç¡®
- [x] é”™è¯¯å¤„ç†æç¤ºå‹å¥½

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### APIå˜æ›´

#### `Leader.search()` å‡½æ•°ç­¾å
**æ—§ç‰ˆæœ¬**:
```python
def search(self, prompt, output_path=None, vector_search=false):
```

**æ–°ç‰ˆæœ¬**:
```python
def search(self, prompt, output_path=None, vector_search=False, 
           search_mode='metafusion'):
```

**å˜æ›´è¯´æ˜**:
- æ–°å¢ `search_mode` å‚æ•°
- ä¿®æ­£ `vector_search` é»˜è®¤å€¼ä¸ºPythonçš„ `False`
- ä¿æŒå‘åå…¼å®¹

### æ•°æ®æµ

#### MetaFusionæ¨¡å¼:
```
Query â†’ Extract Metadata â†’ Filter Silos â†’ Vector Search (Selected) â†’ Aggregate
```

#### Vector Onlyæ¨¡å¼:
```
Query â†’ Vector Search (All Silos) â†’ Aggregate
```

#### Metadata Onlyæ¨¡å¼:
```
Query â†’ Extract Metadata â†’ Database Query â†’ Return
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å…¸å‹æ€§èƒ½è¡¨ç°

**å°æ•°æ®é›†** (< 1000å¼ å›¾ç‰‡):
- Metadata Only: ~0.01-0.05ç§’
- Vector Only: ~1-3ç§’
- MetaFusion: ~1-3ç§’
- æœç´¢ç©ºé—´å‡å°‘: 20-40%

**ä¸­æ•°æ®é›†** (1000-10000å¼ ):
- Metadata Only: ~0.05-0.1ç§’
- Vector Only: ~3-10ç§’
- MetaFusion: ~3-8ç§’
- æœç´¢ç©ºé—´å‡å°‘: 30-50%

**å¤§æ•°æ®é›†** (> 10000å¼ ):
- Metadata Only: ~0.1-0.5ç§’
- Vector Only: ~10-30ç§’
- MetaFusion: ~8-20ç§’
- æœç´¢ç©ºé—´å‡å°‘: 40-60%

---

## ğŸ” éªŒè¯æ–¹æ³•

### 1. åŠŸèƒ½éªŒè¯
```bash
# ç¡®è®¤ä¸‰ç§æœç´¢æ¨¡å¼éƒ½èƒ½æ­£å¸¸å·¥ä½œ
python -c "
from leader.leader import Leader
l = Leader('localhost', 8000, 'state/', 'ViT-B/32', 'cpu', True)
l.search('test', search_mode='metadata_only')
l.search('test', vector_search=True, search_mode='vector_only')
l.search('test', vector_search=True, search_mode='metafusion')
print('âœ“ All modes working')
"
```

### 2. å¯¹æ¯”æµ‹è¯•éªŒè¯
```bash
# è¿è¡Œå®Œæ•´å¯¹æ¯”æµ‹è¯•
python test_search_comparison.py
```

### 3. å‘½ä»¤è¡ŒéªŒè¯
```bash
# å¯åŠ¨leaderå¹¶æµ‹è¯•æ‰€æœ‰æ–°å‘½ä»¤
python main.py leader
# ç„¶ååœ¨äº¤äº’ç•Œé¢ä¸­æµ‹è¯•æ‰€æœ‰å‘½ä»¤
```

---

## ğŸ“ å­¦ä¹ èµ„æº

1. **å¿«é€Ÿå…¥é—¨**: é˜…è¯» `QUICK_START_COMPARISON.md`
2. **è¯¦ç»†æŒ‡å—**: é˜…è¯» `SEARCH_COMPARISON_GUIDE.md`
3. **æŠ€æœ¯æ–‡æ¡£**: é˜…è¯» `SEARCH_COMPARISON_UPDATE.md`
4. **å®è·µç»ƒä¹ **: è¿è¡Œ `test_search_comparison.py`

---

## ğŸ“ æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. Leaderå’ŒFollowerèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
3. å›¾ç‰‡æ˜¯å¦åŒ…å«å…ƒæ•°æ®
4. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

## ğŸ”œ æœªæ¥æ”¹è¿›

å¯èƒ½çš„æ‰©å±•æ–¹å‘ï¼š
1. æ·»åŠ å‡†ç¡®åº¦è¯„ä¼°ï¼ˆéœ€è¦æ ‡æ³¨æ•°æ®ï¼‰
2. å¯è§†åŒ–å¯¹æ¯”ç»“æœ
3. æ”¯æŒè‡ªå®šä¹‰è¯„ä¼°æŒ‡æ ‡
4. æ·»åŠ æ€§èƒ½profilingå·¥å…·
5. å®ç°A/Bæµ‹è¯•æ¡†æ¶
6. æ”¯æŒæ›´å¤šå…ƒæ•°æ®ç±»å‹
7. ä¼˜åŒ–å¼‚æ­¥ç»“æœæ”¶é›†æœºåˆ¶

---

**æ›´æ–°æ—¥æœŸ**: 2025-11-20  
**ç‰ˆæœ¬**: MetaFusion v1.1  
**ä½œè€…**: AI Assistant

